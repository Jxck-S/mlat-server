version: '3.8'

services:
  mlat-server:
    build: .
    container_name: mlat-server
    restart: unless-stopped
    
    # Use host network mode for best performance (minimal network overhead)
    # This is recommended for production deployments
    network_mode: host
    
    # Alternative: Use bridge mode with port mapping (slight performance overhead)
    # Uncomment the ports section and comment out network_mode above to use bridge mode
    # ports:
    #   - "31090:31090"  # Client connections
    #   - "31003:31003"  # Filtered basestation output
    #   - "31004:31004"  # Basestation output
    
    # Volume for persistent data
    volumes:
      - mlat-data:/run/mlat-server
    
    # Environment variables for performance tuning
    environment:
      - MKL_NUM_THREADS=1
      - NUMEXPR_NUM_THREADS=1
      - OMP_NUM_THREADS=1
      - PYTHONOPTIMIZE=2
    
    # Resource limits for standalone docker-compose
    # Note: For Docker Swarm, use the deploy section instead
    mem_limit: 2g
    cpus: 2.0
    mem_reservation: 512m
    
    # Custom command (override default if needed)
    # command: >
    #   /opt/mlat-venv/bin/python3 /opt/mlat-server/mlat-server
    #   --client-listen 31090
    #   --filtered-basestation-listen 31003
    #   --basestation-listen 31004
    #   --write-csv /run/mlat-server/positions.csv
    #   --work-dir /run/mlat-server

volumes:
  mlat-data:
    driver: local
